{% extends "base.html" %}
{% block title %}Приложение 1 · DMG{% endblock %}
{% block content %}
<section class="card">
  <h1>Приложение 1 (из Excel)</h1>
  <form method="get" action="{{ url_for('appendix') }}">
    <label class="field">
      <span>Артист</span>
      <input type="text" name="artist" value="{{ artist or '' }}" placeholder="Введите имя артиста как в Excel">
    </label>
    <div class="actions">
      <button class="btn outline" type="submit">Показать треки</button>
    </div>
  </form>
</section>

{% if tracks is not none %}
<section class="card">
  <h2>Найдено треков: {{ tracks.shape[0] }}</h2>

  <form method="post" action="{{ url_for('appendix_generate') }}">
    <input type="hidden" name="artist" value="{{ artist or '' }}">

    {% if placeholders %}
      <div class="card" style="margin-top:12px;">
        <h3>Данные для подстановки в текст</h3>
        <div class="grid">
          {% for ph in placeholders %}
            <label class="field">
              <span>{{ ph }}</span>
              <input type="text" name="ph:{{ ph }}" placeholder="{{ ph }}">
            </label>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <p class="muted" style="margin-top:8px;">Выбери треки (по умолчанию — все):</p>
    <ul class="files">
      {# ВАЖНО: сбрасываем индекс, чтобы чекбоксы были 0..N-1 #}
      {% for i, row in tracks.reset_index(drop=True).iterrows() %}
        <li>
          <label style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" name="sel" value="{{ i }}" checked>
            <span>
              <b>{{ row.get('track_name','') }}</b>
              · {{ row.get('artist_name','') }}
              {% if row.get('isrc','') %} · ISRC: {{ row.get('isrc') }}{% endif %}
            </span>
          </label>
        </li>
      {% endfor %}
    </ul>

    <div class="actions">
      <button class="btn solid" type="submit">Собрать «Приложение 1»</button>
    </div>
  </form>
</section>
{% endif %}
{% endblock %}
